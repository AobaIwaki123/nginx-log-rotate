# Nginx ログのローテーション設定
/var/log/nginx/*.log {
    # ローテーション頻度：1日ごと（デバッグ用）
    daily
    # 保持するローテーション世代数：3世代（デバッグ用）
    rotate 3
    # ローテーション後の古いログを圧縮
    compress
    # 直近の1世代は圧縮を遅延させる（圧縮は次回ローテーション時）
    delaycompress
    # 対象ファイルがなくてもエラーにしない
    missingok
    # 空ファイルはローテーションしない
    notifempty
    # ローテーションしたファイル名に日付サフィックスを付与
    dateext
    # 新規ログファイルを作成：パーミッション 0644、所有者 nginx、GID nginx
    create 0644 nginx nginx
    # sharedscripts を付けると、対象ログファイルが複数あってもpostrotate/endscript が1回だけ 実行される
    sharedscripts
    # ログローテーション後に実行するスクリプト
    postrotate
        # Nginx にログ再オープンを指示
        # 「ログを reopen しろ」と Nginx に通知しないと、Nginx は古いファイルに書き込み続けてしまうため、必須
        if [ -f /run/nginx.pid ]; then
            /usr/sbin/nginx -s reopen >/dev/null 2>&1 || true
        fi
    endscript
}
